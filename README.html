<!DOCTYPE html>
<html lange="en">
  <head>
    <title>Contrail source code</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <script type="text/javascript" src="analytics.js"></script>
  </head>

  <body>
    <div class="container">
      <div class="page-header">
      <h1>Contrail source code instructions</h1>
      </div>

      <p class="lead">
	The source code for the contrail network virtualization system uses several code repositories, currently hosted in GitHub. The source code for the configuration server, control-plane, analytics and compute-node agent is located in
<a href="https://github.com/Juniper/contrail-controller">github.com/Juniper/contrail-controller</a>. The source code for the dataplane component is located in
<a href="https://github.com/Juniper/contrail-vrouter">github.com/Juniper/contrail-vrouter</a>. Several other repositories that contain build tools and code generators are also used.</p>
    </div>

    <p>
    </p>

    <div class="container">
      <p>
	In order to create a sandbox that can be used to build the
	complete system there are several steps. Overview:
	<ol>
	  <li>Obtain a suitable machine to use, likely a VM running a
	    supported Linux distribution like Ubuntu or Redhat.
	  <li>Make sure basic repository tools (i.e., git and android
	    repo) are installed.
	  <li>Create a sandbox.
	  <li>Satisfy build tool requirements (distro-specific).
	  <li>Download source for additional 3rd party software used in
	    the build.
	  <li>Build it.
	</ol>
	Details for this list are in the following sections.</p>

      <h3>1. Linux Build Machine</h3>
      <div class="container">
	<p>Several distributions are supported:
	  <ul>
	    <li>CentOS
	    <li>RHEL
	    <li>Scientific 6.4
	    <li>Ubuntu 12.04
	    <li>Ubuntu 14.04
	  </ul>
	  You will also need to have a ssh keypair, and should be
	  familiar with using ssh (<b>hint:</b> ssh-agent).
	</p>
      </div>
      <h3>2. Repository Tools</h3>
      <div class="container">
	<p>We use the google multiple repository tool, andoid
	  repo. Here's
	  the <a href="http://code.google.com/p/git-repo">download/install link</a>.
	  This requires <code>git &gt;=
	    1.7.2</code> to be installed on the build system.</p>
	<p>Before you can create a sandbox with repo you will need a github
	  account, and you will need to set up ssh access to github.</p>
      </div>
      <h3>3. Create Sandbox</h3>
      <div class="well">
	<p>
	  To create a development sandbox you can use the following steps:
	  <ul>
	    <li> mkdir &lt;dirname&gt;; cd &lt;dirname&gt; </li>
	    <li> repo init -u git@github.com:Juniper/contrail-vnc </li>
	    <li> repo sync </li>
	  </ul>
	</p>
      </div>
      <h3>4. Build Tool Requirements</h3>
      <div class="container">
	<p>
	  The build depends on several tools including:
	  <ul>
	    <li> scons >= 2.1.0 </li>
	    <li> gcc c++ >= 4.4.7 </li>
	    <li> flex </li>
	    <li> bison </li>
	    <li> xxd (included as part of the vim-common package in redhat based distributions). </li>
	    <li> libstdc++ </li>
	    <li> libboost </li>
	    <li> python development support </li>
	    <li> python lxml, setuptools, sphinx packages </li>
	    <li> openssl development support </li>
	    <li> autoconf</li>
	  </ul>
	  Distro-specific package-install commands follow. Note that
	  you should first make sure your system is up-to-date.
	</p>
	<h4>4.1 CentOS, RedHat Enterprise Linux based distros</h4>
	<p>On RHEL/CentOS/Scientific 6.4 the build dependencies can be
	      installed by the
	      following command:</p>
	    <div class="well">
	      yum install -y scons git python-lxml wget gcc patch make unzip
	      flex bison gcc-c++ openssl-devel autoconf automake vim
	      python-devel python-setuptools protobuf protobuf-devel protobuf-compiler
	    </div>
	    <p>On CentOS 6.6, there are a few additional build dependencies:</p>
	      <ul>
		<li>libtool
		<li>kernel-devel
		<li>automake >= 2.65
	      </ul>
	    <p>The first two are handled by the following command:</p>
	    <div class="well">
	      yum install -y libtool kernel-devel
	    </div>
	    <p>The newer automake requires more fiddling, as most yum
	    repositories for Centos 6.x will have v2.63 automake.
	    Here is a
	    <a href="http://rpm.pbone.net/index.php3/stat/4/idpl/23605747/dir/centos_6/com/autoconf-2.69-12.2.noarch.rpm.html">
	    link to automake-2.69 for CentOS 6.x.</a></p>
	    <p>
	    The up-to-date build dependency list can be found in your sandbox.
	    See the sandbox file <code>tools/packages/rpm/contrail/contrail.spec</code>
	    for <code>BuildRequires</code> entries.
	    </p>
	    <h5>4.1.1 CentOS 7</h5>
	    <p>The ability to build on CentOS 7 is a work in progress,
	    so all caveats apply.</p>
	    <p>
	      Like CentOS 6.6, these packages are also required by
	      CentOS 7, and can be installed using the
	      same <code>yum</code> command as for CentOS 6.6 (see above).
	      <ul>
		<li>libtool
		<li>kernel-devel
	      </ul>
	    </p>
	    <p>Centos 7 has some additional complexity due to build
	    dependencies on the following:</p>
	      <ol>
		<li>bzip2
		<li>boost-devel
		<li>tbb-devel
		<li>libcurl-devel
		<li>libxml2-devel
		<li>scons
		<li>protobuf
		<li>protobuf-devel
		<li>protobuf-compiler
	      </ol>
	    <p>Packages (1) through (5) can be installed with
	    this <code>yum</code> command:</p>
	    <div class="well">
	      yum install -y bzip2 boost-devel tbb-devel libcurl-devel libxml2-devel
	    </div>
	    <p>The packages (6) through (9) are not in the default
	    CentOS 7 repository, but they can be installed from the
	    epel repository.
	    To install access to the epel repository, run these two commands:</p>
	    <div class="well">
	      yum install -y https://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-2.noarch.rpm<br>
	      sed -i -e 's/enabled=1/enabled=0/' /etc/yum.repos.d/epel.repo
	    </div>
	    <p>After installing and enabling epel access, packages (6)
	    through (9) can be installed:
	    <div class="well">
	      yum install -y --disablerepo="*" --enablerepo="epel" scons protobuf protobuf-devel protobuf-compiler
	    </div>
	    </p>
	    <p>
	      As stated, configuring CentOS 7 to build Contrail is currently a work in progress.
	      To make it a bit less tedious, Flavio Fernandes has
	      provided a provisioning script that adds epel repository
	      access and also installs all needed packages (i.e., a
	      one-step configure script).
	      Here is a
	      <a href="https://github.com/flavio-fernandes/opencontrail-dev-centos7/blob/master/provision.sh">
		link to the github-hosted provisioning script.</a>
	    </p>
	    <h4>4.2 Debian-based distros</h4>
	    <p>
              On Ubuntu both 12.04 and 14.04 the basic build
              dependencies can be installed by the following command:
	    <div class="well">
              apt-get install -y scons git python-lxml wget gcc patch make unzip
              flex bison g++ libssl-dev autoconf automake libtool pkg-config vim
              python-dev python-setuptools libprotobuf-dev protobuf-compiler
	    </div>
	    Up-to-date list is in the sandbox
	    file <code>tools/packages/debian/contrail/debian/control</code>,
	    look for the <code>Build-Depends:</code> list.
	    </p>
	    <p>
              On Ubuntu 14.04 these additional build dependencies are required:
	    <div class="well">
	      apt-get install -y libboost-dev libboost-chrono-dev
              libboost-date-time-dev libboost-filesystem-dev
              libboost-program-options-dev libboost-python-dev
              libboost-regex-dev libboost-system-dev
              libcurl4-openssl-dev google-mock libgoogle-perftools-dev
              liblog4cplus-dev libtbb-dev libhttp-parser-dev
              libxml2-dev libicu-dev
	    </div>
	    See the sandbox
	    file <code>tools/packages/debian/contrail/debian/builddep.trusty</code>
	    for up-to-date list.
	    </p>
	  <h3>5. Third-Party Source</h3>
	  <div class="container">
	    <p>
	      Before building the software you will need to download other
	      open source software libraries used by the controller
	      repository. The python
	      script <code>third_party/fetch_packages.py</code> automates
	      this process and automatically applies patches to some of
	      these libraries.</p>
	  </div>
	  <h3>6. Build with scons</h3>
	  <div class="container">
	    <p>
	      Contrail uses <a href="http://scons.org">SCons</a> as
	      its build tool. You should have installed it on your
	      system in step (4). To build, execute the
	      command <code>scons</code> at the top-level sandbox
	      directory.</p>
	  </div>
      <p>Please report build issues in the <a
    href=http://lists.opencontrail.org/mailman/listinfo/dev_lists.opencontrail.org">
    developers mailing list</a>.</p>
    </div>

    <div class="container">
      <p>Common problems:
      <ul>
	<li><p>build/lib/libthriftasio.a is not generated.<p>
	<p>This library is added to thrift via a patch. It requires
      autoconf to be installed in the system in order for
      <code>configure</code> to regenerate itself.</p></li>
      </ul>
      </p>
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://code.jquery.com/jquery.js"></script>

    <!-- Optional theme -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>


  </body>
</html>
