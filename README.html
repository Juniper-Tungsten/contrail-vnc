<!-- (c) 2014 Juniper Networks, Inc. -->
<!DOCTYPE html>
<html lange="en">
  <head>
    <title>Contrail source code</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <script type="text/javascript" src="analytics.js"></script>
  </head>

  <body>
    <div class="container">
      <div class="page-header">
      <h1>Contrail source code instructions</h1>
      </div>

      <p class="lead">
	The source code for the contrail network virtualization system uses several code repositories, currently hosted in GitHub. The source code for the configuration server, control-plane, analytics and compute-node agent is located in
<a href="https://github.com/Juniper/contrail-controller">github.com/Juniper/contrail-controller</a>. The source code for the dataplane component is located in
<a href="https://github.com/Juniper/contrail-vrouter">github.com/Juniper/contrail-vrouter</a>. Several other repositories that contain build tools and code generators are also used.</p>
    </div>

    <p>
    </p>

    <div class="container">
      <p>
	In order to create a sandbox that can be used to build the
	complete system there are several steps. Overview:
	<ol>
	  <li>Obtain a suitable machine to use, likely a VM running a
	    supported Linux distribution like Ubuntu or Redhat.
	  <li>Make sure basic repository tools (i.e., git and android
	    repo) are installed.
	  <li>Create a sandbox.
	  <li>Satisfy build tool requirements (distro-specific).
	  <li>Download source for additional 3rd party software used in
	    the build.
	  <li>Build it.
	</ol>
	Details for this list are in the following sections.</p>

      <h3>1. Linux Build Machine</h3>
      <div class="container">
	<p>Several distributions are supported:
	  <ul>
	    <li>CentOS
	    <li>RHEL
	    <li>Scientific 6.4
	    <li>Ubuntu 12.04
	    <li>Ubuntu 14.04
	  </ul>
	  You will also need to have a ssh keypair, and should be
	  familiar with using ssh (<b>hint:</b> ssh-agent).
	</p>
      </div>
      <h3>2. Repository Tools</h3>
      <div class="container">
        <p> The tools <code>repo</code> and <code>git</code> should be installed to pull a development sandbox.</p>
	<p>We use the google multiple repository tool, the andoid
	  repo. Here's
	  the <a href="http://code.google.com/p/git-repo">download/install link</a>.</p>
        <p> <code> apt-get install git </code> should install git.</p>
	<p>Before you can create a sandbox you will need a github
	  account, and you will need to set up ssh access to github.</p>
      </div>
      <h3>3. Create Sandbox</h3>
      <div class="well">
	<p>
	  To create a development sandbox you can use the following steps:
	  <ul>
	    <li> mkdir &lt;dirname&gt;; cd &lt;dirname&gt; </li>
	    <li> repo init -u git@github.com:Juniper/contrail-vnc </li>
	    <li> repo sync </li>
	  </ul>
	</p>
      </div>
      <h3>4. Build Tool Requirements</h3>
      <div class="container">
	<p>
	  The build depends on several tools which are listed in the following distribution specific sections.
	</p>
	<h4>4.1 CentOS, RedHat Enterprise Linux based distros</h4>
	<p>On RHEL/CentOS/Scientific 6.4 the basic build dependencies can be
	      installed by the
	      following command:</p>
	    <div class="well">
	      yum install -y scons git python-lxml wget gcc patch make unzip
	      flex bison gcc-c++ openssl-devel autoconf automake vim
	      python-devel python-setuptools protobuf protobuf-devel protobuf-compiler
              net-snmp-python
	    </div>
	    <p>In addition to the above, contrail build requires the following:</p>
            <p><code>libipfix:</code> this needs to be installed manually by downloading from
          http://sourceforge.net/projects/libipfix/files/libipfix/libipfix_110209.tgz </p>
            <p><code>librdkafka:</code> this needs to be installed manually by downloading from
           https://github.com/edenhill/librdkafka/librdkafka-0.8.5.tar.gz</p>

	    <p>The following sections provide additional info for
	    specific CentOS releases</p>
	    <h5>4.1.1 CentOS 6.6</h5>
	    <p>On CentOS 6.6, there are a few additional build dependencies:</p>
	      <ul>
		<li>libtool
		<li>kernel-devel
		<li>automake >= 2.65
	      </ul>
	    <p>The first two are handled by the following command:</p>
	    <div class="well">
	      yum install -y libtool kernel-devel
	    </div>
	    <p>The newer automake requires more fiddling, as most yum
	    repositories for Centos 6.x will have v2.63 automake.
	    Here is a
	    <a href="http://rpm.pbone.net/index.php3/stat/4/idpl/23605747/dir/centos_6/com/autoconf-2.69-12.2.noarch.rpm.html">
	    link to automake-2.69 for CentOS 6.x.</a></p>
	    <p>
	    The up-to-date build dependency list can be found in your sandbox.
	    See the sandbox file <code>tools/packages/rpm/contrail/contrail.spec</code>
	    for <code>BuildRequires</code> entries.
	    </p>
	    <h5>4.1.2 CentOS 7</h5>
	    <p>The ability to build on CentOS 7 is a work in progress,
	    so all caveats apply.</p>
	    <p>
	      Like CentOS 6.6, these packages are also required by
	      CentOS 7, and can be installed using the
	      same <code>yum</code> command as for CentOS 6.6 (see above).
	      <ul>
		<li>libtool
		<li>kernel-devel
	      </ul>
	    </p>
	    <p>Centos 7 has some additional complexity due to build
	    dependencies on the following:</p>
	      <ol>
		<li>bzip2
		<li>boost-devel
		<li>tbb-devel
		<li>libcurl-devel
		<li>libxml2-devel
		<li>zlib-devel
		<li>scons
		<li>protobuf
		<li>protobuf-devel
		<li>protobuf-compiler
	      </ol>
	    <p>Packages (1) through (6) can be installed with
	    this <code>yum</code> command:</p>
	    <div class="well">
	      yum install -y bzip2 boost-devel tbb-devel libcurl-devel libxml2-devel zlib-devel
	    </div>
	    <p>The packages (7) through (10) are not in the default
	    CentOS 7 repository, but they can be installed from the
	    epel repository.
	    To install access to the epel repository, run these two commands:</p>
	    <div class="well">
	      yum install -y epel-release<br>
	      sed -i -e 's/enabled=1/enabled=0/' /etc/yum.repos.d/epel.repo
	    </div>
	    <p>After installing and enabling epel access, packages (6)
	    through (9) can be installed:
	    <div class="well">
	      yum install -y --enablerepo="epel" scons protobuf protobuf-devel protobuf-compiler
	    </div>
	    </p>
	    <p>
	      As stated, configuring CentOS 7 to build Contrail is currently a work in progress.
	      To make it a bit less tedious, Flavio Fernandes has
	      provided a provisioning script that adds epel repository
	      access and also installs all needed packages (i.e., a
	      one-step configure script).
	      Here is a
	      <a href="https://github.com/flavio-fernandes/opencontrail-dev-centos7/blob/master/provision.sh">
		link to the github-hosted provisioning script.</a>
	    </p>
	    <h4>4.2 Debian-based distros</h4>
	    <p>
              On Ubuntu both 12.04 and 14.04 the basic build
              dependencies are specified in the sandbox file <code>tools/packages/debian/contrail/debian/control</code>,
	    look for the <code>Build-Depends:</code> list.
            There are some packages in the Build-Depends list that come from opencontrail PPA. Hence the following need to be
            done.
	    <div class="well">
                apt-add-repository ppa:opencontrail/ppa<br>
                apt-get update
	    </div>

	    The current common list is as below, but it's recommended to pick
            the latest list from the file <code>tools/packages/debian/contrail/debian/control</code>.
	    <div class="well">
              apt-get install -y autoconf automake bison debhelper flex libcurl4-openssl-dev libexpat-dev libgettextpo0 libprotobuf-dev
               libtool libxml2-utils make protobuf-compiler python-all python-dev python-lxml python-setuptools python-sphinx ruby-ronn
               scons unzip vim-common libsnmp-python libipfix-dev librdkafka-dev librdkafka1
	    </div>
	    </p>
	    <p>
              On Ubuntu 14.04 these additional build dependencies are required:
	    See the sandbox
	    file <code>tools/packages/debian/contrail/debian/builddep.trusty</code>
	    for up-to-date list.
            The current list is as below, but it's recommended to pick the latest from the builddep.trusty file.
	    <div class="well">
	      apt-get install -y libboost-dev libboost-chrono-dev
              libboost-date-time-dev libboost-filesystem-dev
              libboost-program-options-dev libboost-python-dev
              libboost-regex-dev libboost-system-dev
              libcurl4-openssl-dev google-mock libgoogle-perftools-dev
              liblog4cplus-dev libtbb-dev libhttp-parser-dev
              libxml2-dev libicu-dev
	    </div>
	    </p>
	    Following are also required that need to be downloaded and installed
	    <div class="well">
            wget http://downloads.datastax.com/cpp-driver/ubuntu/14.04/cassandra-cpp-driver_2.2.0-1_amd64.deb<br>
            wget http://downloads.datastax.com/cpp-driver/ubuntu/14.04/cassandra-cpp-driver-dev_2.2.0-1_amd64.deb<br>
            wget http://downloads.datastax.com/cpp-driver/ubuntu/14.04/libuv_1.7.5-1_amd64.deb<br><br>
            dpkg -i libuv_1.7.5-1_amd64.deb cassandra-cpp-driver_2.2.0-1_amd64.deb cassandra-cpp-driver-dev_2.2.0-1_amd64.deb
	    </div>
	    </p>
	  <h3>5. Third-Party Source</h3>
	  <div class="container">
	    <p>
	      Before building the software you will need to download other
	      open source software libraries used by the controller
	      repository. The python
	      script <code>third_party/fetch_packages.py</code> automates
	      this process and automatically applies patches to some of
	      these libraries.</p>
	  </div>
	  <h3>6. Build with scons</h3>
	  <div class="container">
	    <p>
	      Contrail uses <a href="http://scons.org">SCons</a> as
	      its build tool. You should have installed it on your
	      system in step (4). To build, execute the
	      command <code>scons</code> at the top-level sandbox
	      directory.</p>
	  </div>
	  <h3>7. Run unit tests with scons</h3>
	    <p>A few more packages are required to run unit tests and they need to be installed
            as below.</p>
	    <div class="well">
              apt-get install python-virtualenv python-libxml2 libxslt1-dev
            </div>
	    <p>Additionally make sure <code>ping `hostname`</code> works.</p>
	  <div class="container">
	    <p>
	      To run unit tests, execute the
	      command <code>scons test</code> at the top-level sandbox
	      directory.</p>
	  </div>
	  <h3>8. Configuration Schema Documentation</h3>
	  <p> Autogenerated Sphinx-API based documentation for the configuration schema is <a href="https://github.com/Juniper/contrail-vnc/blob/gh-pages/api-doc/html/index.html" here.</a></p>
	  <h3>9. Contact list</h3>
    <div>
      <p>Please report build issues in the <a
    href=http://lists.opencontrail.org/mailman/listinfo/dev_lists.opencontrail.org">
    developers mailing list</a>.</p>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://code.jquery.com/jquery.js"></script>

    <!-- Optional theme -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>


  </body>
</html>
